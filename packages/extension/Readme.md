# Create language extension

Visual Studio Code, includes the ability to introduce any programming language to it, to create syntax highlighting for any language, and to create a debugger for any language.

See [Writing Your Own Debugger and Language Extensions with Visual Studio Code](https://www.codemag.com/Article/1809051/Writing-Your-Own-Debugger-and-Language-Extensions-with-Visual-Studio-Code) for a thorough walk-through

This article goes through:

- Rich Language Services
- REPL language interpretation
- Debugging.

This article builds on:

- [How to Write Your Own Programming Language in C#](https://www.codemag.com/article/1607081)
- [Developing Cross-Platform Native Apps with a Functional Scripting Language](https://www.codemag.com/article/1711081)

CSCS (Customized Scripting in C#) is a scripting language, which is very easy to integrate into any C# code and adjust according to your needs. Basically, it's not only a language, but also a framework that you can use to create your own language. CSCS has been described in:

- [Customized Scripting in C#](https://msdn.microsoft.com/en-us/magazine/mt632273.aspx), MSDN
- [Programming your own language in C#](http://www.codemag.com/Article/1607081), CODE Magazine
- [Implementing a Custom Language Succinctly](https://www.syncfusion.com/resources/techportal/details/ebooks/implementing-a-custom-language), Syncfusion E-book

<br>The usage of CSCS in Mobile App development has been described in:

- [Developing Cross-Platform Native Apps with a Functional Language](http://www.codemag.com/article/1711081), CODE Magazine
- [Writing Native Mobile Apps Using a Customizable Scripting Language](https://msdn.microsoft.com/en-us/magazine/mt829272), MSDN
- [Writing Native Mobile Apps in a Functional Language Succinctly](https://www.syncfusion.com/ebooks/writing_native_mobile_apps_in_a_functional_language_succinctly), Syncfusion E-book

To be able to publish an extension, you must also [create a Visual Studio Team Services account](https://docs.microsoft.com/en-us/azure/devops/user-guide/what-happened-vsts?view=azure-devops).

[Sign up to Azure Devops](https://azure.microsoft.com/en-gb/services/devops/)

Upon registration, you receive the publisher name that you’ll need when generating an extension below.

This is going to show you how to add a new language support on a first level, including:

- Syntax highlighting
- Brackets matching
- Auto indenting

For the publisher name, select the name you used when you created the Visual Studio Team Services account. For language support, Visual Studio Code uses the [TextMate language grammars](https://manual.macromates.com/en/language_grammars). The files that define the grammar have the .tmLanguage extension. This grammar is also used for syntax highlighting. Writing such a file from scratch is quite an exercise. Because syntactically CSCS is similar to C#, I just took a file defining the [C# grammar](https://raw.githubusercontent.com/dotnet/csharp-tmLanguage/master/grammars/csharp.tmLanguage) and provided it when creating the language support extension

Once the language support is created, the `cs.tmLanguage` file will be copied to the syntaxes subfolder. To make it work for CSCS, you have to do a few changes there. First of all, rename `cs.tmLanguage` file name to `cscs.tmLanguage`. Then open this file in VS Code, and replace of the occurrences of `.cs` with `.cscs`.

You add the CSCS language definition to the contributes part of package.json:

```json
"contributes": {
  "languages": [{
    "id": "cscs",
    "aliases": ["CSCS", "cscs"],
    "extensions": [".cscs"],
    "configuration":
        "./language-configuration.json"
  }],
  "grammars": [{
    "language": "cscs",
    "scopeName": "source.cscs",
    "path": "./syntaxes/cscs.tmLanguage"
  }],
```

The language-configuration.json file was also generated by the extension generator. Basically, it contains definitions of opening and closing braces, brackets, quotes, comments, etc. This is, for instance, how the language comments and brackets are defined:

```json
"comments": {
  "lineComment": "//",
  "blockComment": [ "/*", "*/" ]
},
"brackets": [
  ["{", "}"],
  ["[", "]"],
  ["(", ")"]
],
```

If you want to introduce a new comment or bracket type, the language-configuration.json is the file to do that.

## Adding a REPL Extension

REPL (read eval print loop) is an interactive computer environment that permits evaluating simple user inputs and returning the results. Usually the user selects some parts of the code and sends it for evaluation. If nothing is selected, the whole line is sent for evaluation. The cool thing about REPL is that you can even select a commented-out statement and send it for evaluation!

use the yo extension generation tool that you used in the previous section. This time, you choose the extension type New Extension (TypeScript) (this is the default extension type). Then you copy the language files you generated in the previous section (`syntaxes\cscs.tmLanguage` and `language-configuration.json`) to the new extension folder.

Now you can open the newly generated extension folder in VS Code.

The first task is to create a new command, which will send the REPL request for evaluation. Most of these types of tasks are located under the contributes section in the package.json file.

Let’s call the REPL command `extension.cscs.repl` (the name really doesn’t matter) and assign it a key of `Control + 9` on Windows and Linux and `Command + 9` on macOS. This can be done in the `contributes` section of the `package.json` file as follows:

```json
"commands": [{
    "command": "extension.cscs.repl",
    "title": "CSCS REPL"
}],
"keybindings": [{
    "command": "extension.cscs.repl",
    "key": "ctrl+9",
    "mac": "cmd+9",
    "when": "editorTextFocus"
}],
```

You also have to tell VS Code when the extension will be activated. This is done in the `activationEvents` section of `package.json`:

```json
"activationEvents": [
  "onCommand:extension.cscs.repl"
],
```

What this means is that the extension will be activated as soon as the user hits the `Cmd+9` or `Ctrl+9` keys.

## Create language extension

From [Create Custom Language in Visual Studio Code](https://stackoverflow.com/questions/30687783/create-custom-language-in-visual-studio-code)

You need a `.tmLanguage` file for the language you want to add. You can find existing files e.g. on GitHub or you can define your own language file. Look here to get an idea of how to create one: [tm language grammars](http://manual.macromates.com/en/language_grammars)

After finding a `.tmLanguage` file you have two ways to create an extension based on it.

Option 1: Using a _Yeoman_ generator

- Install node.js (if you haven't already done)
- Install `yo` (if you haven't already done) by executing `npm install -g yo`
  Install the Yo generator for code: `npm install -g generator-code`
- Run `yo code` and select `New language support`
- Follow the instructions (define the `.tmLangauge file`, define the plugin name, file extensions etc.)
- The generator creates a directory for your extension with the name of the plugin in your current working directory.

Option 2: Create the directory on your own

Create a _directory with the name of your plugin_ (only _lowercase letters_). Let's say we call it `mylang`.

Add a subfolder `syntaxes` and place the `.tmlanguage` file inside of it

Create a file `package.json` inside the root of the extension folder with content like this

```json
{
  "name": "mylang",
  "version": "0.0.1",
  "engines": {
    "vscode": ">=0.9.0-pre.1"
  },
  "publisher": "me",
  "contributes": {
    "languages": [
      {
        "id": "mylang",
        "aliases": ["MyLang", "mylang"],
        "extensions": [".mylang", ".myl"]
      }
    ],
    "grammars": [
      {
        "language": "mylang",
        "scopeName": "source.mylang",
        "path": "./syntaxes/mylang.tmLanguage"
      }
    ]
  }
}
```

Finally add your extension to Visual Studio Code:

- Copy the extension folder to the extension directory. This is:
  - on `Windows %USERPROFILE%\.vscode\extensions`
  - on `Mac/Linux $HOME/.vscode/extensions`
- Restart Code.

Now your extension will run automatically everytime you open a file with the specified file extension. You can see the name of the used plugin in the down right corner. You can change it by clicking on the name of the extension. If your extension is not the only one registered for a specific file extension then Code may chooses the wrong one.
